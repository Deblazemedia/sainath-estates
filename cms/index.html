<!doctype html>
<html lang="en" class="minimal-theme">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="/assets/img/favicons/favicon-16x16.png" type="image/png" />
  <!--plugins-->
  <link href="assets/plugins/simplebar/css/simplebar.css" rel="stylesheet" />
  <link href="assets/plugins/perfect-scrollbar/css/perfect-scrollbar.css" rel="stylesheet" />
  <link href="assets/plugins/metismenu/css/metisMenu.min.css" rel="stylesheet" />
  <!-- Bootstrap CSS -->
  <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
  <link href="assets/css/bootstrap-extended.css" rel="stylesheet" />
  <link href="assets/css/style.css" rel="stylesheet" />
  <link href="assets/css/icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

  <!-- loader-->
  <link href="assets/css/pace.min.css" rel="stylesheet" />


  <!--Theme Styles-->
  <link href="assets/css/dark-theme.css" rel="stylesheet" />
  <link href="assets/css/light-theme.css" rel="stylesheet" />
  <link href="assets/css/semi-dark.css" rel="stylesheet" />
  <link href="assets/css/header-colors.css" rel="stylesheet" />

  <title>Sainath Estate - Real Estate Agent</title>

  <!-- Fonts Awesome CSS -->
  <link rel="stylesheet" type="text/css" href="/assets/vendors/fontawesome/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

</head>

<body>


  <!--start wrapper-->
  <div class="wrapper">
    <!--start top header-->
    <header class="top-header">
      <nav class="navbar navbar-expand">
        <div class="mobile-toggle-icon d-xl-none">
          <i class="bi bi-list"></i>
        </div>

        <div class="search-toggle-icon d-xl-none ms-auto">
          <!-- <i class="bi bi-search"></i> -->
        </div>
        <form class="searchbar d-none d-xl-flex ms-auto">
          <!-- <div class="position-absolute top-50 translate-middle-y search-icon ms-3"><i class="bi bi-search"></i></div> -->
          <input class="form-control" type="text">
          <div class="position-absolute top-50 translate-middle-y d-block d-xl-none search-close-icon"><i
              class="bi bi-x-lg"></i></div>
        </form>
        <div class="top-navbar d-none d-xl-block">
          <ul class="navbar-nav align-items-center">
            <li class="nav-item">
              <a class="nav-link" href="https://sainathestate.com/" target="_blank"><i
                  class="fa-solid fa-arrow-up-right-from-square"></i> &nbsp; View
                Website
              </a>
            </li>
          </ul>
        </div>
        <div class="top-navbar-right ms-3">
          <ul class="navbar-nav align-items-center">
            <li class="nav-item dropdown dropdown-large">
              <a class="nav-link dropdown-toggle dropdown-toggle-nocaret" href="#" data-bs-toggle="dropdown">
                <div class="user-setting d-flex align-items-center gap-1">
                  <img src="assets/images/avatars/avatar-1.png" class="user-img" alt="">
                  <div class="user-name d-none d-sm-block">Bunty</div>
                </div>
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <a class="dropdown-item" href="#">
                    <div class="d-flex align-items-center">
                      <img src="assets/images/avatars/avatar-1.png" alt="" class="rounded-circle" width="60"
                        height="60">
                      <div class="ms-3">
                        <h6 class="mb-0 dropdown-user-name">Bunty</h6>
                        <small class="mb-0 dropdown-user-designation text-secondary">Admin</small>
                      </div>
                    </div>
                  </a>
                </li>
                <li>
                  <hr class="dropdown-divider">
                </li>
                <li>
                  <a class="dropdown-item" href="#" onclick="logout()">
                    <div class="d-flex align-items-center">
                      <div class="setting-icon"><i class="fa-solid fa-arrow-right-from-bracket"></i></div>
                      <div class="setting-text ms-3"><span>Logout</span></div>
                    </div>
                  </a>

                </li>
              </ul>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    <!--end top header-->

    <!--start sidebar -->
    <aside class="sidebar-wrapper" data-simplebar="true">
      <div class="sidebar-header">
        <div>
          <img src="/assets/img/logo_2.png" class="logo-icon" alt="logo icon">
        </div>

        <div class="toggle-icon ms-auto"><i class="bi bi-chevron-double-left"></i>
        </div>
      </div>
      <!--navigation-->
      <ul class="metismenu" id="menu">
        <li>
          <a href="index.html">
            <div class="parent-icon"><i class="fa-solid fa-building"></i>
            </div>
            <div class="menu-title">Properties</div>
          </a>
        </li>
        <!-- <li>
          <a href="gallery.html">
            <div class="parent-icon"><i class="fa-solid fa-image"></i>
            </div>
            <div class="menu-title">Gallery Images</div>
          </a>
        </li> -->
        <li>
          <a href="#" onclick="logout()">
            <div class="parent-icon"><i class="fa-solid fa-arrow-right-from-bracket"></i></div>
            <div class="menu-title">Logout</div>
          </a>

        </li>
      </ul>
      <!--end navigation-->
    </aside>
    <!--end sidebar -->

    <!--start content-->
    <main class="page-content">
      <!--breadcrumb-->
      <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">

        <div class="ps-3">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0 p-0">

              <li class="breadcrumb-item active" aria-current="page">Properties List</li>
            </ol>
          </nav>
        </div>
        <div class="ms-auto">
          <div class="btn-group">
            <a href="add-new-property.html">
              <button type="button" class="btn btn-primary">Add New Property</button></a>
          </div>
        </div>
      </div>
      <!--end breadcrumb-->

      <div class="card">
        <div class="card-body">
          <div class="table-responsive">
            <table class="table align-middle table-striped">
              <thead class="text-muted small text-uppercase">
                <tr>
                  <th style="width: 15%;">Image</th>
                  <th style="width: 25%;">Title</th>
                  <th style="width: 15%;">Price</th>
                  <th style="width: 15%;">Published Date</th>
                  <th style="width: 20%;">Location</th>
                  <th style="width: 10%;" class="text-end">Options</th>
                </tr>
              </thead>
              <tbody id="propertyTableBody"></tbody>
              <!-- Pagination -->
              <nav class="float-end mt-4" id="paginationControls" aria-label="Page navigation"></nav>
            </table>
          </div>
        </div>
      </div>

  </div>

  </main>
  <!--end page main-->


  <!--start overlay-->
  <div class="overlay nav-toggle-icon"></div>
  <!--end overlay-->

  <!--Start Back To Top Button-->
  <a href="javaScript:;" class="back-to-top"><i class='bx bxs-up-arrow-alt'></i></a>
  <!--End Back To Top Button-->

  <!--start switcher-->
  <!--end switcher-->

  </div>
  <!--end wrapper-->


  <!-- Bootstrap bundle JS -->
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <!--plugins-->
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/plugins/simplebar/js/simplebar.min.js"></script>
  <script src="assets/plugins/metismenu/js/metisMenu.min.js"></script>
  <script src="assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js"></script>
  <script src="assets/js/pace.min.js"></script>
  <!--app-->
  <script src="assets/js/app.js"></script>
  <script>
    const PROPERTIES_PER_PAGE = 10;
    let allProperties = [];
    let currentPage = 1;

    // üîê LOGIN HANDLER
    async function handleLogin(event) {
      event.preventDefault();
      const email = document.getElementById('inputEmailAddress').value;
      const password = document.getElementById('inputChoosePassword').value;

      try {
        const res = await fetch('https://sainath-estate-backend-production.up.railway.app/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await res.json();
        if (res.ok) {
          localStorage.setItem('token', data.token);
          window.location.href = '/cms/index.html';
        } else {
          alert(data.error || 'Invalid login credentials');
        }
      } catch (err) {
        console.error('Login error:', err);
        alert('Login failed. Please try again later.');
      }
    }


    // üõ° PROTECT DASHBOARD
    function protectDashboard() {
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = '/cms/admin-signin.html';
        return;
      }
      window.history.pushState(null, null, window.location.href);
      window.onpopstate = function () {
        window.history.go(1);
      };
    }

    // üì¶ LOAD PROPERTIES
    async function loadProperties() {
      const token = localStorage.getItem('token');
      if (!token) return window.location.href = '/cms/admin-signin.html';

      try {
        const res = await fetch('https://sainath-estate-backend-production.up.railway.app/api/properties/view-all', {
          headers: { Authorization: `Bearer ${token}` }
        });

        const data = await res.json();
        if (res.ok) {
          allProperties = data;
          renderPage(1);
        } else {
          alert(data.error || 'Failed to load properties');
        }
      } catch (err) {
        console.error('Property load error:', err);
        alert('Error loading property list');
      }
    }

    // üéØ PAGINATION LOGIC
    function renderPage(page) {
      currentPage = page;
      const startIndex = (page - 1) * PROPERTIES_PER_PAGE;
      const endIndex = startIndex + PROPERTIES_PER_PAGE;
      const paginatedData = allProperties.slice(startIndex, endIndex);
      renderProperties(paginatedData);
      renderPaginationControls(allProperties.length);
    }

    // üñº RENDER PROPERTY TABLE
    function renderProperties(properties) {
      const tbody = document.getElementById('propertyTableBody');
      tbody.innerHTML = '';
      const baseUrl = 'https://sainath-estate-backend-production.up.railway.app';

      if (!Array.isArray(properties) || properties.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center">No properties found</td></tr>';
        return;
      }

      properties.forEach(item => {
        const imageUrl = item.slider_image
          ? `${baseUrl}/uploads/${item.slider_image}`
          : 'https://via.placeholder.com/80x60?text=No+Image';
        const detailUrl = `https://sainathestate.com/property-details.html?id=${item._id}`;
        const price = item.formattedPrice || `‚Çπ${item.price?.toLocaleString('en-IN')}`;
        const createdDate = new Date(item.createdAt).toLocaleDateString('en-IN');
        const location = item.location || '‚Äî';

        const row = document.createElement('tr');

        const isDraft = item.status !== 'available'; // status check
        const titleWithDraft = isDraft
          ? `${item.title} <span class="badge bg-secondary ms-2">DRAFT</span>`
          : item.title;

        row.innerHTML = `
  <td>
    <img src="${imageUrl}" alt="Property" width="60" class="img-thumbnail" style="cursor:pointer;" onclick="showImagePopup('${imageUrl}')">
  </td>
  <td>${titleWithDraft}</td>
  <td>${price}</td>
  <td>${createdDate}</td>
  <td>${location}</td>
  <td class="text-end">
    <a href="${detailUrl}" target="_blank" class="text-primary me-2" title="View"><i class="bi bi-eye-fill"></i></a>
    <a href="/cms/add-new-property.html?id=${item._id}" class="text-warning me-2" title="Edit"><i class="bi bi-pencil-fill"></i></a>
    <a href="#" class="text-danger" title="Delete"><i class="bi bi-trash-fill"></i></a>
  </td>
`;
        tbody.appendChild(row);

      });
    }

    // üß≠ RENDER PAGINATION BUTTONS
    function renderPaginationControls(totalItems) {
      const paginationContainer = document.getElementById('paginationControls');
      if (!paginationContainer) return;

      paginationContainer.innerHTML = '';
      const totalPages = Math.ceil(totalItems / PROPERTIES_PER_PAGE);

      if (totalPages <= 1) return;

      const ul = document.createElement('ul');
      ul.className = 'pagination';

      for (let i = 1; i <= totalPages; i++) {
        const li = document.createElement('li');
        li.className = 'page-item' + (i === currentPage ? ' active' : '');
        li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
        li.addEventListener('click', (e) => {
          e.preventDefault();
          renderPage(i);
        });
        ul.appendChild(li);
      }

      paginationContainer.appendChild(ul);
    }

    // üñº POPUP IMAGE VIEW WITH SMOOTH ANIMATION
    function showImagePopup(url) {
      const popup = document.createElement('div');
      popup.style.cssText = `
    position: fixed; top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.7);
    display: flex; justify-content: center; align-items: center;
    z-index: 9999; opacity: 0;
    transition: opacity 0.3s ease;
  `;

      const img = document.createElement('img');
      img.src = url;
      img.style.cssText = `
    max-width: 90%; max-height: 90%;
    border-radius: 8px; box-shadow: 0 0 20px #000;
    transform: scale(0.95);
    transition: transform 0.3s ease;
  `;

      popup.appendChild(img);
      document.body.appendChild(popup);

      // Trigger animation
      void popup.offsetWidth;
      popup.style.opacity = '1';
      img.style.transform = 'scale(1)';

      // Close popup on click with fade-out
      popup.addEventListener('click', () => {
        popup.style.opacity = '0';
        img.style.transform = 'scale(0.95)';
        setTimeout(() => popup.remove(), 300);
      });
    }


    // üöÄ INIT
    document.addEventListener('DOMContentLoaded', () => {
      const loginForm = document.querySelector('form.form-body');
      if (loginForm) {
        loginForm.addEventListener('submit', handleLogin);
      }
      if (document.getElementById('propertyTableBody')) {
        protectDashboard();
        loadProperties();
      }
    });
  </script>
  <script>
    function logout() {
      localStorage.removeItem('token');
      window.location.href = '/cms/admin-signin.html';
    }
  </script>




</body>

</html>